# OpenWrt
记录一下Op使用中遇到的问题
# 物理机安装

## 全新的电脑里面没有操作系统

准备操作：使用一个U盘 ，在里面创建一个PE系统，然后准备一个写盘工具、op.img的固件，统统放入U盘的剩余空间中。

ps：常见 使用   https://m0n0.ch/wall/physdiskwrite.php    这个工具

### 具体操作方式

1、制作好U盘，插入电脑，选择U盘为第一启动项（F11、F12）

2、进入PE系统后，运行命令行窗口CMD，打开U盘的剩余存储空间中存放上述工具和固件的目录，在CMD窗口拖入工具，然后“空格”、“-u”、“空格”，然后再拖入你要写入的固件，回车

例：![image-20240125154148772](E:\教程文档\OPENWRT\image-20240125154148772.png)

3、回车后需要选择你要写入的硬盘，一般都可以通过提示信息来分辨，哪个是你要写入的硬盘，再次回车，这时会需要你来确认操作，输入“y”，回车，开始正式写入操作。

ps:如果提示无法写入，或是没有完全写入，则需要你运用PE中的工具，来格式化硬盘，但是不要创建分区





## 电脑里面已经有操作系统（Linux）

使用 

```
dd if=/tmp/upload/op.img of=/dev/sda
```

   将镜像好的固件，写入到你设备中的磁盘（暂存在内存中，然后才会写入硬盘），写入完成后，需要重启

	dd = disk destroyer
	if = Inbound/Input File
	of = Outbound/Output File
	磁盘1：sda   其中分区sda1、sda2==
	磁盘2：sdb   其中分区sdb1、sdb2==

<img src="E:\教程文档\OPENWRT\image-20240125160931965.png" alt="image-20240125160931965" style="zoom:150%;" />

# 安装好系统后

命令行输入

```
ip a
```

查看固件的默认管理界面

然后后续操作在网页端进行





# Overlay扩容

![image-20240125163207154](E:\教程文档\OPENWRT\image-20240125163207154.png)

扩容软件包可用空间的大小

![image-20240125162947432](E:\教程文档\OPENWRT\image-20240125162947432.png)

这个Loop0即这里所说的空间，这个空间并不是实际存在的。

![image-20240125163631948](E:\教程文档\OPENWRT\image-20240125163631948.png)

## 开始操作

一、新建分区

```
cfdisk
```

![image-20240125163754739](E:\教程文档\OPENWRT\image-20240125163754739.png)

上下键选择到 “Free space” 这个未被使用的空间，左右键选择将要进行的操作 

新建分区

![image-20240125164126580](E:\教程文档\OPENWRT\image-20240125164126580.png)

分配大小

![image-20240125164156436](E:\教程文档\OPENWRT\image-20240125164156436.png)

primary：主分区       extended：扩展分区

![image-20240125164237276](E:\教程文档\OPENWRT\image-20240125164237276.png)

写入分区

![image-20240125164411396](E:\教程文档\OPENWRT\image-20240125164411396.png)

保存操作

![image-20240125164446525](E:\教程文档\OPENWRT\image-20240125164446525.png)

![image-20240125164619445](E:\教程文档\OPENWRT\image-20240125164619445.png)

二、格式化分区

```
mkfs.ext4 /dev/sda3
```

![image-20240125164920742](E:\教程文档\OPENWRT\image-20240125164920742.png)

三、挂载分区

```
mount /dev/sda3 /mnt/sda3
```

![image-20240125165113830](E:\教程文档\OPENWRT\image-20240125165113830.png)

![image-20240125165854592](E:\教程文档\OPENWRT\image-20240125165854592.png)

四、迁移Overly中的配置文件

```
cp -r /overlay/* /mnt/sda3
ls /mnt/sda3
```

![image-20240125165244422](E:\教程文档\OPENWRT\image-20240125165244422.png)

五、更改挂载点

![image-20240125165415424](E:\教程文档\OPENWRT\image-20240125165415424.png)

![image-20240125165503728](E:\教程文档\OPENWRT\image-20240125165503728.png)

![image-20240125165535880](E:\教程文档\OPENWRT\image-20240125165535880.png)

然后重启路由器

ps：以后万一重置路由器，这个sda3的分区不会丢失，里面的文件也都在，仅需重复最后的修改挂载点
